<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Deep Learning – Tzu-Yuan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="styles.scss">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Tzu-Yuan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bs-of-am" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">BS of AM</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bs-of-am">    
        <li>
    <a class="dropdown-item" href="./AM.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./AM_thesis.html">
 <span class="dropdown-text">Quantum Bayesian Inference</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ms-of-dsic" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">MS of DSIC</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ms-of-dsic">    
        <li>
    <a class="dropdown-item" href="./DSIC.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ML.html#assignments">
 <span class="dropdown-text">ML &amp; Data Science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./DL.html#assignments">
 <span class="dropdown-text">Deep Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./BigData.html#assignments">
 <span class="dropdown-text">Big Data Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./DataAnalysis.html#assignments">
 <span class="dropdown-text">Data Analysis Math</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ms-of-sdar" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">MS of SDAR</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ms-of-sdar">    
        <li>
    <a class="dropdown-item" href="./SDAR.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./GISPY.html#assignments">
 <span class="dropdown-text">GIS &amp; Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./EPPS6356.html#assignments">
 <span class="dropdown-text">Data Visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./EPPS6354.html">
 <span class="dropdown-text">Information Management</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./CV.html"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#assignments" id="toc-assignments" class="nav-link active" data-scroll-target="#assignments">Assignments</a>
  <ul>
  <li><a href="#assignment-1-aoi-defect-classification" id="toc-assignment-1-aoi-defect-classification" class="nav-link" data-scroll-target="#assignment-1-aoi-defect-classification">Assignment 1 — AOI Defect Classification</a>
  <ul class="collapse">
  <li><a href="#transfer-learning-strategy" id="toc-transfer-learning-strategy" class="nav-link" data-scroll-target="#transfer-learning-strategy">Transfer Learning Strategy</a></li>
  <li><a href="#model-setup" id="toc-model-setup" class="nav-link" data-scroll-target="#model-setup">Model Setup</a></li>
  <li><a href="#training-setup" id="toc-training-setup" class="nav-link" data-scroll-target="#training-setup">Training Setup</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  <li><a href="#assignment-2-retinal-vessel-segmentation" id="toc-assignment-2-retinal-vessel-segmentation" class="nav-link" data-scroll-target="#assignment-2-retinal-vessel-segmentation">Assignment 2 — Retinal Vessel Segmentation</a>
  <ul class="collapse">
  <li><a href="#sample-retinal-images-from-dataset" id="toc-sample-retinal-images-from-dataset" class="nav-link" data-scroll-target="#sample-retinal-images-from-dataset">Sample Retinal Images from Dataset</a></li>
  <li><a href="#u-net-architecture" id="toc-u-net-architecture" class="nav-link" data-scroll-target="#u-net-architecture">U-Net Architecture</a></li>
  <li><a href="#training-setup-1" id="toc-training-setup-1" class="nav-link" data-scroll-target="#training-setup-1">Training Setup</a></li>
  <li><a href="#segmentation-results" id="toc-segmentation-results" class="nav-link" data-scroll-target="#segmentation-results">Segmentation Results</a></li>
  <li><a href="#quantitative-results" id="toc-quantitative-results" class="nav-link" data-scroll-target="#quantitative-results">Quantitative Results</a></li>
  </ul></li>
  <li><a href="#assignment-3-retinal-image-reconstruction" id="toc-assignment-3-retinal-image-reconstruction" class="nav-link" data-scroll-target="#assignment-3-retinal-image-reconstruction">Assignment 3 — Retinal Image Reconstruction</a>
  <ul class="collapse">
  <li><a href="#autoencoder-architecture" id="toc-autoencoder-architecture" class="nav-link" data-scroll-target="#autoencoder-architecture">AutoEncoder Architecture</a></li>
  <li><a href="#training-setup-2" id="toc-training-setup-2" class="nav-link" data-scroll-target="#training-setup-2">Training Setup</a></li>
  <li><a href="#results-1" id="toc-results-1" class="nav-link" data-scroll-target="#results-1">Results</a></li>
  </ul></li>
  <li><a href="#assignment-4-western-blot-image-generation" id="toc-assignment-4-western-blot-image-generation" class="nav-link" data-scroll-target="#assignment-4-western-blot-image-generation">Assignment 4 — Western Blot Image Generation</a>
  <ul class="collapse">
  <li><a href="#conditional-gan-training-flow" id="toc-conditional-gan-training-flow" class="nav-link" data-scroll-target="#conditional-gan-training-flow">Conditional GAN Training Flow</a></li>
  <li><a href="#generator-architecture" id="toc-generator-architecture" class="nav-link" data-scroll-target="#generator-architecture">Generator Architecture</a></li>
  <li><a href="#discriminator-architecture" id="toc-discriminator-architecture" class="nav-link" data-scroll-target="#discriminator-architecture">Discriminator Architecture</a></li>
  <li><a href="#training-setup-3" id="toc-training-setup-3" class="nav-link" data-scroll-target="#training-setup-3">Training Setup</a></li>
  <li><a href="#results-2" id="toc-results-2" class="nav-link" data-scroll-target="#results-2">Results</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Deep Learning</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<section id="assignments" class="level2">
<h2 class="anchored" data-anchor-id="assignments">Assignments</h2>
<section id="assignment-1-aoi-defect-classification" class="level3">
<h3 class="anchored" data-anchor-id="assignment-1-aoi-defect-classification">Assignment 1 — AOI Defect Classification</h3>
<p><strong>Task:</strong> Classify industrial component images into 6 defect categories using a fine-tuned ResNet-18, trained on the AOI (Automated Optical Inspection) dataset.</p>
<p><strong>Dataset:</strong> AOI Dataset — 2,530 training images, 10,144 test images, 6 classes (normal, void, horizontal defect, vertical defect, edge defect, particle)</p>
<p><strong>Method:</strong> ResNet-18 (ImageNet pretrained) — frozen backbone, fine-tuned classifier head</p>
<section id="transfer-learning-strategy" class="level4">
<h4 class="anchored" data-anchor-id="transfer-learning-strategy">Transfer Learning Strategy</h4>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: {"theme": "base", "themeVariables": {"fontSize": "18px"}, "flowchart": {"padding": 35}}}%%
flowchart LR
    A["Pretrained ResNet-18     "] --&gt; B["Freeze Backbone     "] --&gt; C["Replace fc → 6 cls     "] --&gt; D["Train Classifier     "] --&gt; E["Defect Prediction     "]

    style A fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style B fill:#F5F5F5,color:#424242,stroke:#BDBDBD,stroke-width:2px
    style C fill:#FFF3E0,color:#E65100,stroke:#FFCC80,stroke-width:2px
    style D fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
    style E fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="chart-note teal">
<p><strong>Transfer Learning Strategy:</strong> Freeze all pretrained parameters of ResNet-18, replace only the final fc layer with a 6-class output, and train the classifier head using Adam optimizer (lr=0.001). Data preprocessing: 224x224 RGB, normalized with ImageNet mean/std.</p>
</div>
</section>
<section id="model-setup" class="level4">
<h4 class="anchored" data-anchor-id="model-setup">Model Setup</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> models.resnet18(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Freeze all parameters</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> param <span class="kw">in</span> model.parameters():</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    param.requires_grad <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace final layer for 6-class output</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>num_ftrs <span class="op">=</span> model.fc.in_features</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>model.fc <span class="op">=</span> nn.Linear(num_ftrs, <span class="dv">6</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">'cuda'</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">'cpu'</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> model.to(device)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="training-setup" class="level4">
<h4 class="anchored" data-anchor-id="training-setup">Training Setup</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.CrossEntropyLoss()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(model.fc.parameters(), lr<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>num_epochs <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Input: 224x224 RGB, normalized to ImageNet mean/std</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="results" class="level4">
<h4 class="anchored" data-anchor-id="results">Results</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Epoch</th>
<th>Train Loss</th>
<th>Val Accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.8943</td>
<td>95.26%</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.4654</td>
<td>96.25%</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.2635</td>
<td>96.44%</td>
</tr>
<tr class="even">
<td>10</td>
<td>0.2381</td>
<td>95.85%</td>
</tr>
</tbody>
</table>
<p><strong>Best Validation Accuracy: 96.44%</strong></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DL_files/figure-html/aoi-curve-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="chart-note orange">
<p><strong>Training Curve Analysis:</strong> <span style="color:#FF4D8D;"><strong>Pink</strong></span> Train Loss drops sharply in the first 3 epochs and then plateaus. <span style="color:#18A3A3;"><strong>Teal</strong></span> Val Accuracy reaches its peak of <strong>96.44%</strong> at Epoch 6 (<span style="color:#E65100;">orange diamond</span>), after which slight overfitting occurs (accuracy decreases marginally). The <span style="color:#E65100;">orange dashed line</span> marks the best epoch.</p>
</div>
<hr>
</section>
</section>
<section id="assignment-2-retinal-vessel-segmentation" class="level3">
<h3 class="anchored" data-anchor-id="assignment-2-retinal-vessel-segmentation">Assignment 2 — Retinal Vessel Segmentation</h3>
<p><strong>Task:</strong> Perform binary semantic segmentation of blood vessels in retinal fundus images using a custom U-Net architecture trained on the DRIVE dataset.</p>
<p><strong>Dataset:</strong> DRIVE (Digital Retinal Images for Vessel Extraction) — 22 training, 20 test images, 512x512</p>
<p><strong>Method:</strong> U-Net (5-level encoder-decoder with skip connections) + Focal Tversky Loss</p>
<section id="sample-retinal-images-from-dataset" class="level4">
<h4 class="anchored" data-anchor-id="sample-retinal-images-from-dataset">Sample Retinal Images from Dataset</h4>
<div class="quarto-layout-panel" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="dl_hw2_retina_sample1.png" class="img-fluid figure-img"></p>
<figcaption>Sample 1 — fundus image</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="dl_hw2_retina_sample2.png" class="img-fluid figure-img"></p>
<figcaption>Sample 2 — different vessel pattern</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="dl_hw2_retina_sample3.png" class="img-fluid figure-img"></p>
<figcaption>Sample 3 — optic disc visible</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="u-net-architecture" class="level4">
<h4 class="anchored" data-anchor-id="u-net-architecture">U-Net Architecture</h4>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: {"theme": "base", "themeVariables": {"fontSize": "18px"}, "flowchart": {"padding": 35}}}%%
flowchart TD
    IN["Input 1ch 512x512     "] --&gt; E1["Conv1: 1→64     "]
    E1 --&gt;|Pool 2x| E2["Conv2: 64→128     "]
    E2 --&gt;|Pool 2x| E3["Conv3: 128→256     "]
    E3 --&gt;|Pool 2x| E4["Conv4: 256→512     "]
    E4 --&gt;|Pool 2x| BN["Bottleneck: 512→1024     "]
    BN --&gt; U1["Up: 1024→512     "]
    U1 --&gt;|+skip E4| U2["Up: 512→256     "]
    U2 --&gt;|+skip E3| U3["Up: 256→128     "]
    U3 --&gt;|+skip E2| U4["Up: 128→64     "]
    U4 --&gt;|+skip E1| OUT["Mask Output     "]

    E4 -.-&gt;|"skip"| U1
    E3 -.-&gt;|"skip"| U2
    E2 -.-&gt;|"skip"| U3
    E1 -.-&gt;|"skip"| U4

    style IN  fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style E1  fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style E2  fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style E3  fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style E4  fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style BN  fill:#FFF3E0,color:#E65100,stroke:#FFCC80,stroke-width:2px
    style U1  fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
    style U2  fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
    style U3  fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
    style U4  fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
    style OUT fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="chart-note teal">
<p><strong>U-Net Architecture Color Code:</strong> <span style="color:#1565C0;"><strong>Light blue</strong></span> = Encoder (contracting path), <span style="color:#424242;"><strong>Light gray</strong></span> = MaxPool downsampling, <span style="color:#E65100;"><strong>Light orange</strong></span> = Bottleneck (deepest level, 512-&gt;1024), <span style="color:#2E7D32;"><strong>Light green</strong></span> = Decoder (expanding path) + skip connections. Each skip connection passes spatial details from the encoder to the decoder, preserving high-resolution vessel edge information.</p>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UNet(torch.nn.Module):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, inchannel, outchannel):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(UNet, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Encoder</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv1 <span class="op">=</span> Conv(inchannel, <span class="dv">64</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv2 <span class="op">=</span> Conv(<span class="dv">64</span>, <span class="dv">128</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv3 <span class="op">=</span> Conv(<span class="dv">128</span>, <span class="dv">256</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv4 <span class="op">=</span> Conv(<span class="dv">256</span>, <span class="dv">512</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv5 <span class="op">=</span> Conv(<span class="dv">512</span>, <span class="dv">1024</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pool  <span class="op">=</span> torch.nn.MaxPool2d(<span class="dv">2</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Decoder</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.up1   <span class="op">=</span> torch.nn.ConvTranspose2d(<span class="dv">1024</span>, <span class="dv">512</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv6 <span class="op">=</span> Conv(<span class="dv">1024</span>, <span class="dv">512</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.up2   <span class="op">=</span> torch.nn.ConvTranspose2d(<span class="dv">512</span>, <span class="dv">256</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv7 <span class="op">=</span> Conv(<span class="dv">512</span>, <span class="dv">256</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.up3   <span class="op">=</span> torch.nn.ConvTranspose2d(<span class="dv">256</span>, <span class="dv">128</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv8 <span class="op">=</span> Conv(<span class="dv">256</span>, <span class="dv">128</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.up4   <span class="op">=</span> torch.nn.ConvTranspose2d(<span class="dv">128</span>, <span class="dv">64</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv9 <span class="op">=</span> Conv(<span class="dv">128</span>, <span class="dv">64</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv10 <span class="op">=</span> torch.nn.Conv2d(<span class="dv">64</span>, outchannel, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="training-setup-1" class="level4">
<h4 class="anchored" data-anchor-id="training-setup-1">Training Setup</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Focal Tversky Loss — handles class imbalance in vessel vs background</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> <span class="kw">lambda</span> y_pred, y_true: focal_tversky_loss(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    y_pred, y_true, alpha<span class="op">=</span><span class="fl">0.5</span>, beta<span class="op">=</span><span class="fl">0.5</span>, gamma<span class="op">=</span><span class="fl">0.75</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>scheduler <span class="op">=</span> torch.optim.lr_scheduler.ReduceLROnPlateau(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    optimizer, mode<span class="op">=</span><span class="st">'min'</span>, factor<span class="op">=</span><span class="fl">0.5</span>, patience<span class="op">=</span><span class="dv">5</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">"mps"</span>)  <span class="co"># Apple Silicon</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>num_epochs <span class="op">=</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="segmentation-results" class="level4">
<h4 class="anchored" data-anchor-id="segmentation-results">Segmentation Results</h4>
<p>Each row shows: <strong>Original fundus image</strong> -&gt; <strong>Predicted segmentation mask</strong> -&gt; <strong>Ground truth mask</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="dl_hw2_segmentation_results.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>Segmentation output — Original / Segmentation / Ground Truth (all 20 test images)</figcaption>
</figure>
</div>
<div class="chart-note teal">
<p><strong>Segmentation Results Observation:</strong> The model successfully identifies major vessel trajectories and distributions, but there is still room for improvement in detecting fine capillaries. The ground truth shows many extremely thin capillaries, and the model tends to predict only the thicker vessel structures.</p>
</div>
</section>
<section id="quantitative-results" class="level4">
<h4 class="anchored" data-anchor-id="quantitative-results">Quantitative Results</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean IoU (mIoU)</td>
<td>0.3510</td>
</tr>
<tr class="even">
<td>Training epochs</td>
<td>100</td>
</tr>
<tr class="odd">
<td>Input resolution</td>
<td>512 x 512</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DL_files/figure-html/unet-miou-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="chart-note pink">
<p><strong>mIoU Analysis:</strong> The left chart compares three benchmarks: random baseline (0.05), this U-Net model (<strong>0.351</strong>), and DRIVE dataset SOTA (~0.82). The right chart uses a Venn-style scatter plot to illustrate the IoU concept – <span style="color:#18A3A3;"><strong>teal</strong></span> represents Ground Truth, <span style="color:#FF4D8D;"><strong>pink</strong></span> represents Prediction, and the overlapping region is the Intersection. An mIoU of 0.351 means the overlap between predictions and labels is about 35%, with room for improvement (possible approaches: deeper network, more data augmentation, class-weighted loss).</p>
</div>
<hr>
</section>
</section>
<section id="assignment-3-retinal-image-reconstruction" class="level3">
<h3 class="anchored" data-anchor-id="assignment-3-retinal-image-reconstruction">Assignment 3 — Retinal Image Reconstruction</h3>
<p><strong>Task:</strong> Train a convolutional autoencoder to reconstruct retinal fundus images in an unsupervised manner, evaluated by Peak Signal-to-Noise Ratio (PSNR).</p>
<p><strong>Dataset:</strong> DRIVE — 21 training, 20 test images, 512x512 RGB</p>
<p><strong>Method:</strong> Convolutional Autoencoder (Encoder-Decoder with skip connections) + MSE Loss</p>
<section id="autoencoder-architecture" class="level4">
<h4 class="anchored" data-anchor-id="autoencoder-architecture">AutoEncoder Architecture</h4>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: {"theme": "base", "themeVariables": {"fontSize": "18px"}, "flowchart": {"padding": 35}}}%%
flowchart TD
    IN["Input 3ch 512x512     "] --&gt; C1["Conv1: 3→64     "]
    C1 --&gt;|Pool 2x| C2["Conv2: 64→128     "]
    C2 --&gt;|Pool 2x| C3["Conv3: 128→256     "]
    C3 --&gt;|Pool 2x| C4["Bottleneck: 256→512     "]
    C4 --&gt; U1["Up: 512→256     "]
    U1 --&gt;|+skip C3| U2["Up: 256→128     "]
    U2 --&gt;|+skip C2| U3["Up: 128→64     "]
    U3 --&gt;|+skip C1| OUT["Output: 64→3ch     "]

    C3 -.-&gt;|"skip"| U1
    C2 -.-&gt;|"skip"| U2
    C1 -.-&gt;|"skip"| U3

    style IN  fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style C1  fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style C2  fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style C3  fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style C4  fill:#FFF3E0,color:#E65100,stroke:#FFCC80,stroke-width:2px
    style U1  fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
    style U2  fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
    style U3  fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
    style OUT fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="chart-note teal">
<p><strong>Autoencoder Architecture Color Code:</strong> <span style="color:#1565C0;"><strong>Light blue</strong></span> = Encoder, <span style="color:#E65100;"><strong>Light orange</strong></span> = Bottleneck (256-&gt;512 compressed representation), <span style="color:#2E7D32;"><strong>Light green</strong></span> = Decoder + skip connections. This shares the same encoder-decoder structure as U-Net, but the objective is to reconstruct the input image (self-supervised learning) rather than segmentation.</p>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AutoEncoder(nn.Module):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, inchannel<span class="op">=</span><span class="dv">3</span>, outchannel<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(AutoEncoder, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Encoder</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv1 <span class="op">=</span> Conv(inchannel, <span class="dv">64</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv2 <span class="op">=</span> Conv(<span class="dv">64</span>, <span class="dv">128</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv3 <span class="op">=</span> Conv(<span class="dv">128</span>, <span class="dv">256</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv4 <span class="op">=</span> Conv(<span class="dv">256</span>, <span class="dv">512</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pool  <span class="op">=</span> nn.MaxPool2d(<span class="dv">2</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Decoder (with skip connections)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.up1   <span class="op">=</span> nn.ConvTranspose2d(<span class="dv">512</span>, <span class="dv">256</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv5 <span class="op">=</span> Conv(<span class="dv">512</span>, <span class="dv">256</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.up2   <span class="op">=</span> nn.ConvTranspose2d(<span class="dv">256</span>, <span class="dv">128</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv6 <span class="op">=</span> Conv(<span class="dv">256</span>, <span class="dv">128</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.up3   <span class="op">=</span> nn.ConvTranspose2d(<span class="dv">128</span>, <span class="dv">64</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv7 <span class="op">=</span> Conv(<span class="dv">128</span>, <span class="dv">64</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv8 <span class="op">=</span> nn.Conv2d(<span class="dv">64</span>, outchannel, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="training-setup-2" class="level4">
<h4 class="anchored" data-anchor-id="training-setup-2">Training Setup</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>num_epochs <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalization: mean=0.5, std=0.5</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"mps"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="results-1" class="level4">
<h4 class="anchored" data-anchor-id="results-1">Results</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Epoch</th>
<th>Train Loss</th>
<th>Test Loss</th>
<th>PSNR (dB)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.0979</td>
<td>0.1152</td>
<td>16.29</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.0323</td>
<td>0.0067</td>
<td>27.98</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.0309</td>
<td>0.0055</td>
<td>29.06</td>
</tr>
<tr class="even">
<td>13</td>
<td>0.0263</td>
<td>0.0043</td>
<td>30.16</td>
</tr>
<tr class="odd">
<td><strong>18</strong></td>
<td><strong>0.0280</strong></td>
<td><strong>0.0037</strong></td>
<td><strong>30.84</strong></td>
</tr>
<tr class="even">
<td>20</td>
<td>0.0268</td>
<td>0.0048</td>
<td>29.50</td>
</tr>
</tbody>
</table>
<p><strong>Best PSNR: 30.84 dB at Epoch 18</strong></p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in annotate("label", x = best_ep - 1, y = 32, label = paste0("Best: ",
: Ignoring unknown parameters: `label.size`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DL_files/figure-html/ae-curve-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="chart-note orange">
<p><strong>Training Curve Analysis:</strong> Left chart – <span style="color:#FF4D8D;"><strong>Pink</strong></span> Train Loss and <span style="color:#18A3A3;"><strong>teal dashed</strong></span> Test Loss both drop rapidly in the first 3 epochs and then plateau. Right chart – PSNR peaks at <strong>30.84 dB</strong> at Epoch 18 (exceeding the 30 dB threshold, <span style="color:#7A7A7A;">gray dashed line</span>), then slightly decreases (29.50 dB at Epoch 20), indicating Epoch 18 is the optimal stopping point.</p>
</div>
<hr>
</section>
</section>
<section id="assignment-4-western-blot-image-generation" class="level3">
<h3 class="anchored" data-anchor-id="assignment-4-western-blot-image-generation">Assignment 4 — Western Blot Image Generation</h3>
<p><strong>Task:</strong> Train a conditional GAN to generate Western blot images from two template images, learning the mapping from template patterns to realistic blot patterns.</p>
<p><strong>Dataset:</strong> Western Blot Dataset — 402 template pairs + 402 target images, 64x64 grayscale</p>
<p><strong>Method:</strong> Conditional GAN — Encoder-Decoder Generator + PatchGAN-style Discriminator</p>
<section id="conditional-gan-training-flow" class="level4">
<h4 class="anchored" data-anchor-id="conditional-gan-training-flow">Conditional GAN Training Flow</h4>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: {"theme": "base", "themeVariables": {"fontSize": "18px"}, "flowchart": {"padding": 35}}}%%
flowchart TD
    T1["Template 1: 64x64     "] --&gt; CAT["Concat 2ch     "]
    T2["Template 2: 64x64     "] --&gt; CAT
    CAT --&gt; G["Generator     "]
    G --&gt; FAKE["Generated Image     "]
    REAL["Real Image     "] --&gt; D["Discriminator     "]
    FAKE --&gt; D
    D --&gt;|G loss| UG["Update G     "]
    D --&gt;|D loss| UD["Update D     "]

    style T1   fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style T2   fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style CAT  fill:#F5F5F5,color:#424242,stroke:#BDBDBD,stroke-width:2px
    style G    fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style FAKE fill:#FFF3E0,color:#E65100,stroke:#FFCC80,stroke-width:2px
    style REAL fill:#E8F5E9,color:#2E7D32,stroke:#A5D6A7,stroke-width:2px
    style D    fill:#FCE4EC,color:#C62828,stroke:#F48FB1,stroke-width:2px
    style UG   fill:#E3F2FD,color:#1565C0,stroke:#90CAF9,stroke-width:2px
    style UD   fill:#FCE4EC,color:#C62828,stroke:#F48FB1,stroke-width:2px
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="chart-note teal">
<p><strong>GAN Training Flow:</strong> Two template images are concatenated into a 2-channel input, passed through the <span style="color:#1565C0;"><strong>blue Generator</strong></span> to produce a fake blot image (<span style="color:#E65100;"><strong>orange</strong></span>). The <span style="color:#C62828;"><strong>pink Discriminator</strong></span> determines whether the input is <span style="color:#2E7D32;"><strong>real (green)</strong></span> or <span style="color:#E65100;"><strong>fake (orange)</strong></span>, and returns G loss / D loss to update their respective parameters.</p>
</div>
</section>
<section id="generator-architecture" class="level4">
<h4 class="anchored" data-anchor-id="generator-architecture">Generator Architecture</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TemplateToImageGenerator(nn.Module):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(TemplateToImageGenerator, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.encoder <span class="op">=</span> nn.Sequential(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">1</span>, <span class="dv">64</span>, kernel_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">64</span>), nn.ReLU(),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">64</span>, <span class="dv">128</span>, kernel_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">128</span>), nn.ReLU(),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">128</span>, <span class="dv">256</span>, kernel_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">256</span>), nn.ReLU(),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.decoder <span class="op">=</span> nn.Sequential(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            nn.ConvTranspose2d(<span class="dv">256</span>, <span class="dv">128</span>, kernel_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">128</span>), nn.ReLU(),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            nn.ConvTranspose2d(<span class="dv">128</span>, <span class="dv">64</span>, kernel_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">64</span>), nn.ReLU(),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            nn.ConvTranspose2d(<span class="dv">64</span>, <span class="dv">1</span>, kernel_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            nn.Tanh(),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="discriminator-architecture" class="level4">
<h4 class="anchored" data-anchor-id="discriminator-architecture">Discriminator Architecture</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TemplateToImageDiscriminator(nn.Module):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(TemplateToImageDiscriminator, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> nn.Sequential(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">2</span>, <span class="dv">64</span>, kernel_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            nn.LeakyReLU(<span class="fl">0.2</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">64</span>, <span class="dv">128</span>, kernel_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">128</span>), nn.LeakyReLU(<span class="fl">0.2</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">128</span>, <span class="dv">256</span>, kernel_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">256</span>), nn.LeakyReLU(<span class="fl">0.2</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            nn.AdaptiveAvgPool2d((<span class="dv">1</span>, <span class="dv">1</span>)),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            nn.Flatten(),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">256</span>, <span class="dv">1</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            nn.Sigmoid()</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="training-setup-3" class="level4">
<h4 class="anchored" data-anchor-id="training-setup-3">Training Setup</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>g_optimizer <span class="op">=</span> optim.Adam(generator.parameters(),     lr<span class="op">=</span><span class="fl">0.0002</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>d_optimizer <span class="op">=</span> optim.Adam(discriminator.parameters(), lr<span class="op">=</span><span class="fl">0.0002</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>criterion   <span class="op">=</span> nn.BCELoss()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>num_epochs  <span class="op">=</span> <span class="dv">200</span>    <span class="co"># trained on CPU, stopped at epoch 118</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>batch_size  <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="results-2" class="level4">
<h4 class="anchored" data-anchor-id="results-2">Results</h4>
<p>Training ran on CPU and was recorded up to epoch 118/200. By that point the Discriminator had begun to dominate (D Loss &lt; 0.1 in some steps), causing G Loss to climb – a classic sign the generator needs more capacity or learning rate balancing.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Epoch</th>
<th>D Loss (sample)</th>
<th>G Loss (sample)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1 / step 10</td>
<td>1.3715</td>
<td>0.7412</td>
</tr>
<tr class="even">
<td>1 / step 40</td>
<td>1.3699</td>
<td>0.6840</td>
</tr>
<tr class="odd">
<td>118 / step 200</td>
<td>0.4921</td>
<td>2.2424</td>
</tr>
<tr class="even">
<td>118 / step 230</td>
<td>0.0263</td>
<td>4.2039</td>
</tr>
<tr class="odd">
<td>118 / step 270</td>
<td>0.0683</td>
<td>3.5220</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DL_files/figure-html/gan-training-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="chart-note pink">
<p><strong>GAN Training Dynamics Analysis:</strong> The <span style="color:#7A7A7A;"><strong>gray dashed line ln(2)=0.693</strong></span> represents the ideal GAN equilibrium point (the BCE loss when D cannot distinguish real from fake). In the left chart (raw log), early-stage D Loss is close to ln(2) (D/G near equilibrium), but in later epochs <span style="color:#FF4D8D;"><strong>pink D Loss</strong></span> drops rapidly toward 0 while <span style="color:#18A3A3;"><strong>teal G Loss</strong></span> climbs to 3-4, indicating <strong>Discriminator dominance</strong> (D can easily distinguish real from fake). The right chart (per-epoch averages) shows this divergence more clearly. Possible remedies include lowering D’s learning rate, increasing G’s capacity, or adding label smoothing.</p>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>