---
title: "Wardrobe Database — Final Project"
format:
  html:
    theme: cosmo
    toc: true
    toc-location: right
    toc-depth: 4
    number-sections: false
    page-layout: full
    smooth-scroll: true
---

## Weather- and Occasion-Aware Wardrobe Database with Rule-Based Outfit Recommendation

### Overview

This project builds a single-user wardrobe management database whose primary goal is
outfit recommendation. Each morning, the system reads the user's calendar (to determine
the occasion) and the current weather, filters out unwearable items (dirty or archived),
and ranks candidate outfits using a rule-based scoring engine grounded in color theory,
fabric compatibility, and style coherence. The output is the best recommended outfit plus
3–5 ranked alternatives, each with a score and a brief explanation.

**Core workflow:**

Wake up → Read calendar (occasion) + weather → Filter wearable items → Score outfit
combinations → Output recommendation

**Three scoring dimensions:**

1. **Color** — 60/30/10 color theory; each item carries a `primary / secondary / accent`
   color role, and the engine checks whether the combined outfit achieves a balanced
   palette.
2. **Fabric** — same-fabric bonus (suit effect), mixed-fabric reasonableness, and warmth
   adequacy relative to the weather.
3. **Style** — style-tag consistency across items, and style–occasion fit scores stored in
   `StyleOccasionFit`.

---

### ER Diagram

```{mermaid}
erDiagram
    User {
        int user_id PK
        string name
    }
    Category {
        int category_id PK
        string name
    }
    Color {
        int color_id PK
        string name
    }
    Fabric {
        int fabric_id PK
        string name
        int warmth_weight
        int breathability
    }
    StyleTag {
        int style_id PK
        string name
    }
    Occasion {
        int occasion_id PK
        string name
        int target_formality_min
        int target_formality_max
    }
    StyleOccasionFit {
        int style_id FK
        int occasion_id FK
        int fit_score
    }
    CalendarEvent {
        int event_id PK
        int user_id FK
        string event_name
        int occasion_id FK
        date event_date
        time start_time
    }
    ClothingItem {
        int item_id PK
        int user_id FK
        int category_id FK
        int fabric_id FK
        string brand
        string item_name
        int formality_score
        int warmth_score
        int clean_score
        string status
        datetime created_at
    }
    ItemStyle {
        int item_id FK
        int style_id FK
    }
    ItemColor {
        int item_id FK
        int color_id FK
        string role
    }
    WeatherSnapshot {
        int weather_id PK
        string location
        datetime captured_at
        float temp_c
        float feels_like_c
        int humidity
        float wind_speed
        float precip_mm
    }
    WeatherCondition {
        int condition_id PK
        string name
        float min_temp_c
        float max_temp_c
        float min_precip_mm
        float max_precip_mm
        float min_wind
        float max_wind
        float min_humidity
        float max_humidity
    }
    Outfit {
        int outfit_id PK
        int user_id FK
        int occasion_id FK
        int weather_id FK
        float total_score
        string explanation
        datetime created_at
    }
    OutfitItem {
        int outfit_id FK
        int item_id FK
        string slot
        int layer_order
    }
    OutfitScoringRule {
        int score_rule_id PK
        string name
        string rule_type
        int score_delta
        string explanation_template
        json condition_json
        date valid_from
        date valid_until
    }
    WearDegradeRule {
        int degrade_rule_id PK
        int category_id FK
        int occasion_id FK
        int condition_id FK
        int delta_clean_score
    }
    WearEvent {
        int event_id PK
        int user_id FK
        int outfit_id FK
        int occasion_id FK
        int weather_id FK
        datetime worn_at
    }
    WearEventItem {
        int event_id FK
        int item_id FK
        int delta_applied
        int clean_score_after
    }
    LaundryBatch {
        int batch_id PK
        int user_id FK
        string laundry_type
        datetime created_at
    }
    LaundryBatchItem {
        int batch_id FK
        int item_id FK
        int reset_to_score
        datetime processed_at
    }

    User ||--o{ CalendarEvent : "has"
    User ||--o{ ClothingItem : "owns"
    User ||--o{ Outfit : "generates"
    User ||--o{ WearEvent : "logs"
    User ||--o{ LaundryBatch : "creates"

    Category ||--o{ ClothingItem : "classifies"
    Fabric ||--o{ ClothingItem : "material of"
    Occasion ||--o{ CalendarEvent : "typed as"
    Occasion ||--o{ Outfit : "context of"
    Occasion ||--o{ WearEvent : "context of"
    Occasion ||--o{ WearDegradeRule : "adjusts"

    StyleTag ||--o{ ItemStyle : "tagged to"
    StyleTag ||--o{ StyleOccasionFit : "rated in"
    Occasion ||--o{ StyleOccasionFit : "rates"

    ClothingItem ||--o{ ItemStyle : "has"
    ClothingItem ||--o{ ItemColor : "has"
    ClothingItem ||--o{ OutfitItem : "included in"
    ClothingItem ||--o{ WearEventItem : "tracked by"
    ClothingItem ||--o{ LaundryBatchItem : "washed in"

    Color ||--o{ ItemColor : "used in"

    WeatherSnapshot ||--o{ Outfit : "context of"
    WeatherSnapshot ||--o{ WearEvent : "context of"
    WeatherCondition ||--o{ WearDegradeRule : "adjusts"

    Outfit ||--o{ OutfitItem : "contains"
    Outfit ||--o{ WearEvent : "confirmed by"

    Category ||--o{ WearDegradeRule : "base of"
    WearEvent ||--o{ WearEventItem : "details"
    LaundryBatch ||--o{ LaundryBatchItem : "includes"
```

---

### Schema Design

#### 1. Reference Tables（參考表）

基礎查找表，供其他表透過 FK 引用。獨立成表以避免重複資料，並方便統一維護。

##### User

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `user_id` | INT | PK | 使用者唯一識別碼 |
| `name` | VARCHAR | NOT NULL | 使用者名稱 |

##### Category

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `category_id` | INT | PK | 類別識別碼 |
| `name` | VARCHAR | NOT NULL | 衣物類別，如 top、bottom、shoes、outerwear、accessory |

##### Color

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `color_id` | INT | PK | 顏色識別碼 |
| `name` | VARCHAR | NOT NULL | 顏色名稱，如 black、white、navy、grey、beige |

##### Fabric

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `fabric_id` | INT | PK | 布料識別碼 |
| `name` | VARCHAR | NOT NULL | 布料名稱，如 wool、cotton、linen |
| `warmth_weight` | INT | 0–100 | 保暖度，wool=90、cotton=50、linen=20 |
| `breathability` | INT | 0–100 | 透氣度 |

> Fabric 獨立成表的理由：每件衣物不需重複輸入布料屬性，保暖度和透氣度可直接用於天氣過濾和穿搭評分。

##### StyleTag

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `style_id` | INT | PK | 風格識別碼 |
| `name` | VARCHAR | NOT NULL | 風格名稱，如 street、semi-formal、formal、clean fit、simple |

##### Occasion

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `occasion_id` | INT | PK | 場合識別碼 |
| `name` | VARCHAR | NOT NULL | 場合名稱，如 job interview、casual outing |
| `target_formality_min` | INT | 0–100 | 場合要求的最低正式度 |
| `target_formality_max` | INT | 0–100 | 場合要求的最高正式度 |

---

#### 2. Style–Occasion Fit（風格與場合適配）

記錄每種風格在各場合的適配分數，讓推薦引擎能根據今日場合自動過濾不適合的穿搭風格。

##### StyleOccasionFit

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `style_id` | INT | PK, FK → StyleTag | 風格 |
| `occasion_id` | INT | PK, FK → Occasion | 場合 |
| `fit_score` | INT | 0–100 | 適配分數，如 street + 面試 = 10、semi-formal + 面試 = 90 |

---

#### 3. Calendar Integration（行事曆整合）

系統自動讀取今日行程並對應到場合，省去每天手動選擇場合的步驟。

##### CalendarEvent

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `event_id` | INT | PK | 行程識別碼 |
| `user_id` | INT | FK → User | 使用者 |
| `event_name` | VARCHAR | NOT NULL | 行程名稱 |
| `occasion_id` | INT | FK → Occasion | 對應場合 |
| `event_date` | DATE | NOT NULL | 日期 |
| `start_time` | TIME | NOT NULL | 開始時間 |

---

#### 4. Clothing Item & Tags（衣物與標籤）

核心衣物資料表，記錄每件衣物的物理屬性、狀態，以及多對多的風格標籤。

##### ClothingItem

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `item_id` | INT | PK | 衣物識別碼 |
| `user_id` | INT | FK → User | 擁有者 |
| `category_id` | INT | FK → Category | 衣物類別 |
| `fabric_id` | INT | FK → Fabric | 布料 |
| `brand` | VARCHAR | — | 品牌 |
| `item_name` | VARCHAR | NOT NULL | 衣物名稱 |
| `formality_score` | INT | 0–100 | 正式度分數 |
| `warmth_score` | INT | 0–100 | 保暖分數，結合 Fabric.warmth_weight 使用 |
| `clean_score` | INT | 可為負數 | 清潔度；可推薦條件：`clean_score > 0` |
| `status` | ENUM | active / in_laundry / archived | 衣物狀態；可推薦條件：`status = 'active'` |
| `created_at` | DATETIME | NOT NULL | 建立時間 |

##### ItemStyle

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `item_id` | INT | PK, FK → ClothingItem | 衣物 |
| `style_id` | INT | PK, FK → StyleTag | 風格標籤 |

---

#### 5. Item Color（衣物配色）

每件衣物最多三色，依角色區分（primary / secondary / accent），用於 60/30/10 配色理論評分。

##### ItemColor

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `item_id` | INT | PK, FK → ClothingItem | 衣物 |
| `color_id` | INT | PK, FK → Color | 顏色 |
| `role` | ENUM | PK; primary / secondary / accent | 顏色角色 |

**限制條件：**

- 每件衣物最多 3 筆（各角色各 1）
- `primary`：必填，唯一
- `secondary`：選填，最多 1 個
- `accent`：選填，最多 1 個

**範例：**

| 衣物 | color | role |
|------|-------|------|
| 黑色素T | black | primary |
| Liverpool 球衣 | red | primary |
| Liverpool 球衣 | white | secondary |
| Adidas 三線褲 | black | primary |
| Adidas 三線褲 | navy | secondary |
| Adidas 三線褲 | white | accent |

---

#### 6. Weather（天氣）

##### WeatherSnapshot

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `weather_id` | INT | PK | 天氣快照識別碼 |
| `location` | VARCHAR | NOT NULL | 地點 |
| `captured_at` | DATETIME | NOT NULL | 擷取時間 |
| `temp_c` | FLOAT | — | 實際溫度（°C） |
| `feels_like_c` | FLOAT | — | 體感溫度（°C） |
| `humidity` | INT | — | 濕度（%） |
| `wind_speed` | FLOAT | — | 風速 |
| `precip_mm` | FLOAT | — | 降水量（mm） |

##### WeatherCondition

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `condition_id` | INT | PK | 天氣狀態識別碼 |
| `name` | VARCHAR | NOT NULL | 狀態名稱，如 cold_rainy、hot_humid |
| `min_temp_c` | FLOAT | — | 溫度下限 |
| `max_temp_c` | FLOAT | — | 溫度上限 |
| `min_precip_mm` | FLOAT | — | 降水下限 |
| `max_precip_mm` | FLOAT | — | 降水上限 |
| `min_wind` | FLOAT | — | 風速下限 |
| `max_wind` | FLOAT | — | 風速上限 |
| `min_humidity` | FLOAT | — | 濕度下限 |
| `max_humidity` | FLOAT | — | 濕度上限 |

> WeatherCondition 用於分類天氣狀態，供 WearDegradeRule 規則匹配（例如：下雨天穿白鞋多扣分）。

---

#### 7. Outfit（穿搭組合）

##### Outfit

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `outfit_id` | INT | PK | 穿搭識別碼 |
| `user_id` | INT | FK → User | 使用者 |
| `occasion_id` | INT | FK → Occasion | 場合 |
| `weather_id` | INT | FK → WeatherSnapshot | 天氣快照 |
| `total_score` | FLOAT | — | 穿搭總分 |
| `explanation` | TEXT | — | 推薦說明 |
| `created_at` | DATETIME | NOT NULL | 建立時間 |

##### OutfitItem

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `outfit_id` | INT | PK, FK → Outfit | 穿搭 |
| `slot` | ENUM | PK; top / bottom / shoes / outerwear / accessory | 穿搭位置 |
| `layer_order` | INT | PK; 1, 2, 3… | 層次順序，支援多層穿搭 |
| `item_id` | INT | FK → ClothingItem | 衣物 |

> `(outfit_id, slot, layer_order)` 三欄聯合主鍵，支援同一 slot 不同層次（如外套 + 毛衣同為 outerwear，layer_order = 1, 2）。

---

#### 8. Outfit Scoring Rules（穿搭評分規則）

##### OutfitScoringRule

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `score_rule_id` | INT | PK | 規則識別碼 |
| `name` | VARCHAR | NOT NULL | 規則名稱 |
| `rule_type` | ENUM | color_theory / fabric / style / formality / layering / misc | 規則類型 |
| `score_delta` | INT | — | 分數加減值 |
| `explanation_template` | TEXT | — | 說明模板（輸出推薦理由用） |
| `condition_json` | JSON | — | 結構化條件，方便擴充 |
| `valid_from` | DATE | NOT NULL | 規則生效日期 |
| `valid_until` | DATE | NULLABLE | 規則失效日期（NULL = 永久有效） |

> `valid_from / valid_until` 支援時效性規則，例如：2025 blokecore 流行 → 足球衣 + 寬褲加分，`valid_until = 2025-12`，流行退燒後自動失效，不需修改程式碼。

---

#### 9. Wear Tracking & Laundry（穿著紀錄與洗衣）

##### WearDegradeRule

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `degrade_rule_id` | INT | PK | 規則識別碼 |
| `category_id` | INT | FK → Category | 衣物類別（基礎扣分） |
| `occasion_id` | INT | FK → Occasion, NULLABLE | 場合調整（可選） |
| `condition_id` | INT | FK → WeatherCondition, NULLABLE | 天氣調整（可選） |
| `delta_clean_score` | INT | 負整數 | 每次穿著的扣分值 |

> 支援堆疊扣分：一次穿著可匹配多條規則（類別基礎 + 場合加減 + 天氣加減），加總後套用。

##### WearEvent

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `event_id` | INT | PK | 事件識別碼 |
| `user_id` | INT | FK → User | 使用者 |
| `outfit_id` | INT | FK → Outfit | 穿著的穿搭 |
| `occasion_id` | INT | FK → Occasion | 場合 |
| `weather_id` | INT | FK → WeatherSnapshot | 當日天氣 |
| `worn_at` | DATETIME | NOT NULL | 穿著時間 |

##### WearEventItem

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `event_id` | INT | PK, FK → WearEvent | 穿著事件 |
| `item_id` | INT | PK, FK → ClothingItem | 衣物 |
| `delta_applied` | INT | — | 實際套用的扣分值 |
| `clean_score_after` | INT | — | 扣分後的 clean_score |

##### LaundryBatch

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `batch_id` | INT | PK | 洗衣批次識別碼 |
| `user_id` | INT | FK → User | 使用者 |
| `laundry_type` | ENUM | dark / light | 深色 / 淺色分類洗 |
| `created_at` | DATETIME | NOT NULL | 建立時間 |

##### LaundryBatchItem

| Column | Type | Constraint | Description |
|--------|------|-----------|-------------|
| `batch_id` | INT | PK, FK → LaundryBatch | 洗衣批次 |
| `item_id` | INT | PK, FK → ClothingItem | 衣物 |
| `reset_to_score` | INT | = 100 | 洗完後重設的 clean_score |
| `processed_at` | DATETIME | NOT NULL | 洗完時間 |

---

### Design Rationale（設計理由）

| 設計決策 | 說明 |
|----------|------|
| **Fabric 獨立成表** | 保暖度 (`warmth_weight`) 和透氣度 (`breathability`) 統一管理，每件衣物透過 FK 引用，不重複輸入。布料屬性可直接用於天氣過濾和評分加減。 |
| **ItemColor 三角色設計** | 基於 60/30/10 配色理論，`primary / secondary / accent` 角色讓評分引擎能明確判斷整套穿搭的配色比例是否協調，而非只比對顏色有無。 |
| **StyleOccasionFit** | 明確記錄風格與場合的適配分數，讓系統在篩選穿搭時能自動排除風格不合場合的組合，不需 hard-code 邏輯。 |
| **CalendarEvent 行事曆整合** | 自動對應今日行程到場合，省去每天手動選擇，降低使用門檻。 |
| **OutfitScoringRule 規則表 + condition_json** | 穿搭邏輯完全由資料驅動，修改評分規則只需編輯資料，不需改程式碼。`condition_json` 保持結構靈活，方便未來新增複雜條件。 |
| **valid_from / valid_until** | 支援時效性流行趨勢規則（如 blokecore 2025），規則過期自動失效，維護成本低。 |
| **WearDegradeRule 堆疊扣分** | 一次穿著可同時匹配類別基礎規則、場合調整規則和天氣調整規則，加總扣分，比單一固定值更精確反映實際磨損。 |
| **WearEvent / WearEventItem 事件紀錄** | 保留完整歷史穿著紀錄，每次扣分前後都有快照，提供可追溯性，也為未來偏好學習提供訓練資料。 |

---

### Future Extensions（未來擴充）

- **多人支援**：共享衣櫃、借衣功能，User 表已預留擴充空間。
- **精確配色**：加入 HEX / RGB 色碼欄位，配合色彩距離演算法提升配色判斷精確度。
- **偏好學習**：以 WearEvent 歷史資料訓練排序模型，從規則推薦進化到 AI 個人化推薦。
